<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>–ü—Ä–æ—Ñ–∏–ª—å</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      margin: 0;
      padding: 20px;
      background-color: #f5f5f5;
      color: #333;
    }

    .container {
      max-width: 500px;
      margin: 0 auto;
      background: #fff;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }

    h2 {
      text-align: center;
      margin-bottom: 20px;
    }

    label {
      display: block;
      margin: 15px 0 5px;
      font-weight: 500;
    }

    input {
      width: 100%;
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 6px;
      font-size: 16px;
      box-sizing: border-box;
    }

    button {
      width: 100%;
      padding: 12px;
      margin-top: 20px;
      background-color: #30a7f7;
      color: white;
      border: none;
      border-radius: 6px;
      font-size: 16px;
      cursor: pointer;
      transition: background 0.2s ease-in-out;
    }

    button:hover {
      background-color: #2b95db;
    }
    select {
    width: 100%;
    padding: 10px;
    border: 1px solid #ccc;
    border-radius: 6px;
    font-size: 16px;
    box-sizing: border-box;
  }

  </style>
</head>
<body>
<div class="container">
  <h2>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª—å</h2>
  <label for="gender">–ü–æ–ª</label>
<select id="gender">
  <option value="">‚Äî –≤—ã–±–µ—Ä–∏ ‚Äî</option>
  <option value="–ú—É–∂—á–∏–Ω–∞">–ú—É–∂—á–∏–Ω–∞</option>
  <option value="–ñ–µ–Ω—â–∏–Ω–∞">–ñ–µ–Ω—â–∏–Ω–∞</option>
</select>



  <label for="age">–í–æ–∑—Ä–∞—Å—Ç</label>
  <input id="age" type="number">

  <label for="weight">–í–µ—Å (–∫–≥)</label>
  <input id="weight" type="number">

  <label for="height">–†–æ—Å—Ç (—Å–º)</label>
  <input id="height" type="number">

<label for="goal">–¶–µ–ª—å</label>
<select id="goal">
  <option value="">‚Äî –≤—ã–±–µ—Ä–∏ ‚Äî</option>
  <option value="–ü–æ—Ö—É–¥–µ–Ω–∏–µ">üèÉ –ü–æ—Ö—É–¥–µ–Ω–∏–µ</option>
  <option value="–ù–∞–±–æ—Ä –º–∞—Å—Å—ã">üí™ –ù–∞–±–æ—Ä –º–∞—Å—Å—ã</option>
  <option value="–ü–æ–¥–¥–µ—Ä–∂–∞–Ω–∏–µ —Ñ–æ—Ä–º—ã">‚öñÔ∏è –ü–æ–¥–¥–µ—Ä–∂–∞–Ω–∏–µ —Ñ–æ—Ä–º—ã</option>
</select>

  <button onclick="saveProfile()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
</div>

<script>
  const tg = window.Telegram.WebApp;
  tg.expand();

  let userId = tg.initDataUnsafe?.user?.id;
  if (!userId) {
    const urlParams = new URLSearchParams(window.location.search);
    userId = parseInt(urlParams.get('id')); // <--- –¥–æ–±–∞–≤—å parseInt
  }
  console.log('userId:', userId);


  function loadProfile() {
  fetch(`https://bazafitbackend.onrender.com/get_profile?user_id=${userId}`)
    .then(res => res.json())
    .then(data => {
      if (data) {
        document.getElementById('gender').value = data.gender || '';
        document.getElementById('age').value = data.age || '';
        document.getElementById('weight').value = data.weight || '';
        document.getElementById('height').value = data.height || '';
        document.getElementById('goal').value = data.goal || '';
      }
    })
    .catch(err => console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –ø—Ä–æ—Ñ–∏–ª—è:', err));
}



  function saveProfile() {
  const profile = {
    user_id: userId,
    gender: document.getElementById('gender').value,
    age: parseInt(document.getElementById('age').value),
    weight: parseFloat(document.getElementById('weight').value),
    height: parseFloat(document.getElementById('height').value),
    goal: document.getElementById('goal').value
  };

  fetch('https://bazafitbackend.onrender.com/save_profile', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify(profile)
  })
  .then(res => {
    if (res.ok) {
      tg.close(); // ‚Üê –í–æ—Ç –¢–£–¢ –∑–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è –æ–∫–Ω–æ ‚Äî –ø–æ—Å–ª–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
    } else {
      alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –ø—Ä–æ—Ñ–∏–ª—è');
    }
  })
  .catch(err => {
    alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏ –∫ —Å–µ—Ä–≤–µ—Ä—É');
    console.error(err);
  });
}


    fetch('https://bazafitbackend.onrender.com/save_profile', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(profile)
    })
    .then(res => {
      if (res.ok) {
        tg.close(); // –ó–∞–∫—Ä—ã—Ç—å mini-app
      } else {
        alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –ø—Ä–æ—Ñ–∏–ª—è');
      }
    })
    .catch(err => {
      alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏ –∫ —Å–µ—Ä–≤–µ—Ä—É');
      console.error(err);
    });
  }

  loadProfile();
</script>
</body>
</html>
