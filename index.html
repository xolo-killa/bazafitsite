<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>–ü—Ä–æ—Ñ–∏–ª—å</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <link rel="stylesheet" href="style.css">
</head>
<body>
<div class="container">
  <h2>–ü—Ä–æ—Ñ–∏–ª—å</h2>
  <form id="profileForm" autocomplete="off">
    <div class="form-group">
      <label for="gender">–ü–æ–ª</label>
      <select id="gender" required>
        <option value="" disabled selected hidden>‚Äî –≤—ã–±–µ—Ä–∏ ‚Äî</option>
        <option value="–ú—É–∂—á–∏–Ω–∞">–ú—É–∂—á–∏–Ω–∞</option>
        <option value="–ñ–µ–Ω—â–∏–Ω–∞">–ñ–µ–Ω—â–∏–Ω–∞</option>
      </select>
    </div>

    <div class="form-group">
      <label for="age">–í–æ–∑—Ä–∞—Å—Ç</label>
      <input id="age" type="number" min="10" max="100" required>
    </div>

    <div class="form-group">
      <label for="weight">–í–µ—Å (–∫–≥)</label>
      <input id="weight" type="number" min="20" max="300" step="0.1" required>
    </div>

    <div class="form-group">
      <label for="height">–†–æ—Å—Ç (—Å–º)</label>
      <input id="height" type="number" min="100" max="250" required>
    </div>

    <div class="form-group">
      <label for="goal">–¶–µ–ª—å</label>
      <select id="goal" required>
        <option value="" disabled selected hidden>‚Äî –≤—ã–±–µ—Ä–∏ ‚Äî</option>
        <option value="üèÉ –ü–æ—Ö—É–¥–µ–Ω–∏–µ">üèÉ –ü–æ—Ö—É–¥–µ–Ω–∏–µ</option>
        <option value="üí™ –ù–∞–±–æ—Ä –º–∞—Å—Å—ã">üí™ –ù–∞–±–æ—Ä –º–∞—Å—Å—ã</option>
        <option value="‚öñÔ∏è –ü–æ–¥–¥–µ—Ä–∂–∞–Ω–∏–µ —Ñ–æ—Ä–º—ã">‚öñÔ∏è –ü–æ–¥–¥–µ—Ä–∂–∞–Ω–∏–µ —Ñ–æ—Ä–º—ã</option>
      </select>
    </div>
    <button type="submit" class="save-btn">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
  </form>
</div>
<script>
  const tg = window.Telegram.WebApp;
  tg.expand();

  let userId = tg.initDataUnsafe?.user?.id;
  if (!userId) {
    const urlParams = new URLSearchParams(window.location.search);
    userId = parseInt(urlParams.get('id'));
  }

  function loadProfile() {
    fetch(`https://bazafitbackend.onrender.com/get_profile?user_id=${userId}`)
      .then(res => res.json())
      .then(data => {
        if (data) {
          document.getElementById('gender').value = data.gender || '';
          document.getElementById('age').value = data.age || '';
          document.getElementById('weight').value = data.weight || '';
          document.getElementById('height').value = data.height || '';
          document.getElementById('goal').value = data.goal || '';
        }
      })
      .catch(err => console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –ø—Ä–æ—Ñ–∏–ª—è:', err));
  }

  document.getElementById('profileForm').addEventListener('submit', function(e) {
    e.preventDefault();
    const gender = document.getElementById('gender').value;
    const age = document.getElementById('age').value;
    const weight = document.getElementById('weight').value;
    const height = document.getElementById('height').value;
    const goal = document.getElementById('goal').value;
    if (!gender || !age || !weight || !height || !goal) {
      alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è!');
      return;
    }
    const profile = {
      user_id: userId,
      gender: gender,
      age: parseInt(age),
      weight: parseFloat(weight),
      height: parseFloat(height),
      goal: goal
    };
    fetch('https://bazafitbackend.onrender.com/save_profile', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(profile)
    })
    .then(res => {
      if (res.ok) {
        tg.close();
      } else {
        alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –ø—Ä–æ—Ñ–∏–ª—è');
      }
    })
    .catch(err => {
      alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏ –∫ —Å–µ—Ä–≤–µ—Ä—É');
      console.error(err);
    });
  });

  loadProfile();
</script>
</body>
</html>
